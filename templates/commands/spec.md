---
description: 基于功能描述进行需求分析，生成规范化的需求文档
scripts:
  sh: .specify/scripts/bash/spec.sh --json "{ARGS}"
  ps: .specify/scripts/powershell/spec.ps1 -Json "{ARGS}"
---

基于功能想法生成符合项目规范的需求文档，必须严格遵循需求模板的三部分格式。

**核心约束：专注业务功能，严禁技术实现**

执行步骤：

1. 运行 `{SCRIPT}` 获取当前模块路径和上下文信息
2. 检查当前模块目录中是否存在 `page.png` 设计参考文件
3. 如存在设计稿，读取并参考其中的界面设计来理解业务功能需求
4. 基于用户提供的功能描述生成需求文档初始版本：

**第1部分：背景说明**
- 说明业务背景及目标
- 明确核心用户和使用场景

**第2部分：需求概览，业务流程**  
- 使用Mermaid flowchart展示业务流程
- 包含业务流程图与状态机
- 突出关键决策点和业务分支

**第3部分：EARS格式关键需求条目**
- 基于业务流程图提取关键节点用EARS表达
- 需求ID+标题格式：#### REQ-XXX: 需求标题
- 需求主体使用EARS格式：
  ```markdown
  WHEN xxx
  THE SYSTEM SHALL xxx
  WHERE xxx (可选)
  AND xxx (可选)
  ```

**强制性约束 - 需求类型白名单**：
只能生成以下类型的需求：
1. 功能触发条件需求 (何时显示/触发某功能)
2. 内容展示需求 (显示什么内容/信息)  
3. 用户操作需求 (用户能做什么操作)
4. 权限控制需求 (谁能执行操作)
5. 基本业务规则需求 (简单的业务逻辑)

**严禁生成的需求类型**：
❌ 任何包含"体验"、"性能"、"加载"、"管理"、"适配"、"响应式"等词汇的需求
❌ 页面浏览体验、数据加载、状态管理、界面展示、多端适配等技术实现需求

**关键原则**：
- 只描述用户需要什么功能（WHAT），不涉及如何实现（HOW）
- 静态展示页面最多5个需求，每个需求验收标准不超过3条
- 严禁生成任何技术实现、性能、体验类需求
- 验收标准仅关注业务逻辑，不涉及技术指标

5. 为每个需求生成简洁的验收标准：
   - 静态页面：简单文字描述即可
   - 简单交互：关注核心功能点
   - 复杂业务：可适当使用表格或Gherkin格式

6. 完成需求文档后，询问用户确认："需求和验收标准看起来好吗？如果是，我们可以继续设计。"

7. 如用户要求修改，继续反馈-修订循环直到获得明确批准

8. 收到批准后，明确告知需求阶段完成，并提供下一步指导：

**✅ 需求分析阶段完成！**

**下一步建议：**
- 执行 `/design` 命令开始技术设计阶段
- 设计阶段将基于当前需求文档创建详细的技术方案

使用绝对路径进行所有文件操作，确保路径准确性。