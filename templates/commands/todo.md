---
description: 基于设计文档创建可操作的实现任务清单
scripts:
  sh: .specify/scripts/bash/create-todos.sh --json
  ps: .specify/scripts/powershell/create-todos.ps1 -Json
---

在用户批准设计之后，基于需求和设计创建一个可操作的实现计划，包含编码任务的检查清单。

执行步骤：

1. 运行 `{SCRIPT}` 获取当前模块路径和设计文档信息
2. 确保 design.md 存在并已被用户批准
3. **验证Constitution合规**: 确保设计文档包含完整的合规检查部分，所有checklist项目已确认
4. 检查是否存在类似功能，如有则询问用户确认
5. 如用户指出设计需要更改，返回设计步骤
6. 如用户指出需要额外需求，返回需求步骤

7. 在 `specs/modules/{feature_name}/todo.md` 创建实现计划：

**核心指导原则**：
将功能设计转换为一系列面向代码生成LLM的提示，以测试驱动的方式实现每个步骤。优先考虑最佳实践、增量进展和早期测试，确保在任何阶段都没有复杂性的大跳跃。确保每个提示都建立在之前的提示基础上，并以将事物连接在一起结束。

**Constitution强制要求**：
- 严格遵循TDD原则：每个任务必须先写测试，后实现功能
- 所有任务必须是可增量交付的小步骤
- 测试必须先失败(RED)，然后实现使其通过(GREEN)
- 任务顺序体现测试优先的开发流程

**任务格式要求**：
- 格式化为编号复选框列表，最多两级层次结构
- 顶级项目（如史诗）仅在需要时使用
- 子任务使用十进制记号编号（例如，1.1、1.2、2.1）
- 每个项目必须是复选框
- 首选简单结构

**每个任务项目必须包括**：
- 作为任务描述的清晰目标，涉及编写、修改或测试代码
- 在任务下的子项目形式的附加信息
- 对需求文档中需求的具体引用（引用细粒度的REQ-XXX需求）
- 对应验收标准的测试实现任务

**测试驱动开发要求**：
- 为每个REQ-XXX需求创建对应的测试实现任务
- 确保测试任务能够验证spec.md中定义的验收标准
- 将Gherkin格式的验收场景转换为具体的测试实现任务
- 为每个Gherkin场景创建对应的自动化测试任务

**测试优先级安排**：
- 首先实现单元测试框架和基础测试
- 为核心业务逻辑编写单元测试（验证Given-When-Then场景）
- 为组件交互编写集成测试
- 为用户场景编写端到端测试（直接对应Gherkin场景）

**任务可操作性要求**：
确保每个任务都可以由编码代理操作：
- 任务应该涉及编写、修改或测试特定的代码组件
- 任务应该指定需要创建或修改哪些文件或组件
- 任务应该足够具体，编码代理可以在不需要额外澄清的情况下执行它们
- 任务应该专注于实现细节而不是高级概念
- 任务应该限定在特定的编码活动（例如，"实现X函数"而不是"支持X功能"）
- 测试任务应该明确指定要验证的验收标准和测试场景
- 测试任务应该明确引用对应的Gherkin场景和Given-When-Then步骤

**明确避免的非编码任务**：
- 用户验收测试或用户反馈收集
- 部署到生产或测试环境
- 性能指标收集或分析
- 运行应用程序以测试端到端流程（但可以编写自动化测试）
- 用户培训或文档创建
- 业务流程变更或组织变更
- 营销或沟通活动
- 任何无法通过编写、修改或测试代码完成的任务

7. 确保实现计划是一系列离散的、可管理的编码步骤
8. 确保每个任务引用需求文档中的具体需求
9. 确保每个步骤在之前步骤的基础上增量构建
10. 确保计划涵盖设计中可以通过代码实现的所有方面
11. 确保所有需求都被实现任务覆盖
12. 为验收标准创建自动化测试任务
13. 如在实现计划期间发现缺口，提供返回之前步骤的选项

14. 完成任务文档后询问用户："任务看起来好吗？"
15. 如用户要求修改，继续反馈-修订循环直到获得明确批准
16. 收到批准后，明确告知任务规划阶段完成，并提供下一步指导：

**✅ 任务规划阶段完成！**

**下一步建议：**
- 开始执行 todo.md 中的具体编码任务
- 执行 `/sync` 命令同步进度到项目路线图
- 按照任务清单进行测试驱动开发

**重要提醒**：此工作流程仅用于创建设计和计划工件。功能的实际实现应该通过单独的工作流程完成。不得尝试作为此工作流程的一部分实现功能。

使用绝对路径进行所有文件操作，确保路径准确性。