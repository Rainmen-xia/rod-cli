# 模板技术规范

本文档定义了 ROD CLI 工作流模板的技术规范和开发标准。

## 模板文件结构规范

### 1. 文件命名

- 所有命令文件使用 `.md` 扩展名
- 文件名应简洁明了，反映命令的主要功能
- 使用小写字母和连字符分隔，如 `module.md`, `specify.md`

### 2. 文件结构

每个命令文件必须包含以下部分：

#### Front Matter（必需）
```yaml
---
description: 命令的简短描述，说明其主要功能
scripts:
  node: node .rod/scripts/script-name.js --json {ARGS}
---
```

#### 命令说明（必需）
- 简要介绍命令的用途和价值
- 使用清晰的中文描述

#### 用法示例（推荐）
```markdown
**用法示例：**
- `/command arg1` - 单个参数示例
- `/command arg1 arg2` - 多个参数示例
```

#### 执行步骤（必需）
```markdown
**执行步骤：**
1. 步骤一的详细描述
2. 步骤二的详细描述
3. 输出结果和下一步指导
```

#### 下一步指导（推荐）
```markdown
**下一步：**
指导用户执行后续命令或操作
```

### 3. 脚本引用规范
- 脚本路径使用相对路径 `.rod/scripts/`
- 使用 Node.js (`node`) 统一脚本执行环境
- 参数传递使用 `{ARGS}` 占位符
- 依赖 Node.js 内置模块，无需额外依赖

## 文档模板说明

### templates/ 目录结构
默认工作流提供四个核心文档模板，位于 `workflow/spec-templates/` 目录：

#### 1. `spec-template.md` - 功能规范模板
- **用途**: 定义功能的业务需求和验收标准
- **结构**: 使用 EARS 格式（易于评审、可实现、明确、相关、可测试）
- **占位符**: `[功能名称]`、`[业务场景]`、`[验收标准]` 等
- **适用**: 需求分析阶段，产品功能定义

#### 2. `plan-template.md` - 技术设计模板
- **用途**: 生成技术实现方案和架构设计
- **结构**: 包含技术选型、架构设计、接口定义、数据模型等
- **占位符**: `[技术栈]`、`[架构图]`、`[接口规范]` 等
- **适用**: 技术设计阶段，架构规划

#### 3. `tasks-template.md` - 任务规划模板
- **用途**: 将设计方案分解为具体的开发任务
- **结构**: 包含开发任务、测试任务、部署任务等清单
- **占位符**: `[任务列表]`、`[优先级]`、`[工期估算]` 等
- **适用**: 开发阶段，任务管理

#### 4. `roadmap-template.md` - 项目路线图模板
- **用途**: 生成项目整体进度规划
- **结构**: 包含里程碑、模块依赖、时间线等
- **占位符**: `[项目名称]`、`[里程碑]`、`[交付节点]` 等
- **适用**: 项目管理，整体规划

### 模板设计特征
- **占位符格式**: 使用 `[描述性名称]` 标记需要替换的内容
- **结构化内容**: 提供完整的章节框架和格式示例
- **指导性说明**: 包含填写提示和最佳实践建议
- **技术无关**: 适用于各种技术栈和项目类型

## 脚本规范

### 1. 脚本组织
- `scripts/` - 包含所有 Node.js 脚本文件
- `scripts/common.js` - 通用工具函数和实用工具

### 2. 脚本命名约定
- 使用连字符分隔的小写命名：`create-module.js`
- 脚本名称应清楚表达其功能
- 统一使用 `.js` 扩展名

### 3. 脚本内容要求
- 使用 Node.js 内置模块实现，无需额外依赖
- 包含必要的错误处理和参数验证
- 支持 `--json` 参数用于结构化输出
- 包含简要的脚本用途说明注释
- 脚本头部使用 `#!/usr/bin/env node` 声明

### 4. 技术要求
- **仅使用 Node.js 内置模块**：`fs`, `path`, `child_process`, `process`
- **严格禁止外部依赖**：不允许使用任何第三方 npm 包，确保脚本的轻量性和独立性
- **跨平台兼容**：确保在 Windows、macOS、Linux 上正常运行
- **轻量设计**：无需安装额外 npm 包依赖
- **错误处理**：合理的异常捕获和用户友好的错误信息

**重要约束**：
- ❌ 禁止添加任何 `require()` 第三方模块
- ❌ 禁止使用 `import` 外部包
- ✅ 只允许使用 Node.js 核心模块（如 `require('fs')`、`require('path')` 等）
- ✅ 允许引用同目录下的 `common.js` 工具函数

### 5. 通用脚本文件
- `common.js` - 包含共享的实用函数，如 `getRepoRoot()`, `getFeaturePaths()` 等
- 其他脚本通过 `require('./common')` 引用共享函数

## 项目宪法规范

### constitution.md 结构
```markdown
# 项目宪法 (Project Constitution)

## 核心原则
- 规范驱动开发
- 测试驱动开发
- 模块化架构
- 增量开发
- 简洁性原则

## 质量门禁
- 设计阶段检查点
- 实现阶段检查点
- 集成阶段检查点

## 开发流程约束
- 五步工作流程
- 文档要求
- 代码提交规范

## 技术约束
- 依赖管理
- 性能要求
- 安全考虑

## 项目特定约束
根据项目特点定制的约束条件

## 治理规则
- 宪法优先级
- 修正流程
- 质量保证
```

## 模板结构标准

### 必需目录结构
```
workflow-template/
├── commands/              # AI 助手命令（必需）
├── scripts/              # Node.js 自动化脚本（推荐）
├── memory/               # 项目宪法（推荐）
├── spec-templates/              #  用于给commands生成spec的模板（推荐）
└── README.md            # 模板说明（必需）
```

## 质量标准

### 命令文件质量要求
- [ ] 包含完整的 Front Matter
- [ ] 命令描述清晰准确
- [ ] 执行步骤详细具体
- [ ] 输出结果和下一步指导明确
- [ ] 遵循 ROD 规范，输出到 specs/ 目录

### 脚本文件质量要求
- [ ] 仅使用 Node.js 内置模块
- [ ] 包含错误处理和参数验证
- [ ] 支持 --json 参数输出
- [ ] 跨平台兼容性
- [ ] 代码注释清晰

### 模板文件质量要求
- [ ] 占位符格式统一
- [ ] 结构化内容完整
- [ ] 包含指导性说明
- [ ] 技术栈无关设计
- [ ] 易于理解和使用

### 文档质量要求
- [ ] README.md 包含模板概述和使用说明
- [ ] workflow.md（如有）定义清晰的工作流程
- [ ] 文档间链接正确
- [ ] 格式统一规范
- [ ] 内容准确无误

---

遵循这些技术规范，可以确保创建的工作流模板具有良好的一致性、可维护性和用户体验。
